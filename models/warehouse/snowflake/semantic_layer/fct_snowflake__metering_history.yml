semantic_models:
  - name: account_metering
    model: ref('fct_snowflake__metering_history')
    description: >
      The METERING_HISTORY view in the ACCOUNT_USAGE schema can be used to return 
      the hourly credit usage for an account within the last 365 days (1 year).
    
    primary_entity: account_metering

    dimensions:
      - name: start_date
        expr: start_time::date
        type: time
        type_params:
          time_granularity: day
      - name: service_type
        description: '{{ doc("snowflake__service_type") }}'
        type: categorical
      - name: service
        description: '{{ doc("snowflake__name") }}'
        type: categorical
        expr: name
    
    defaults:
      agg_time_dimension: start_date

    measures:
      - name: total_elapsed_seconds
        description: End time - start time for in which the usage took place.
        agg: sum
        expr: DATEDIFF(second, start_time, end_time )

      - name: longest_elapsed_seconds
        description: Longest running
        agg: max
        expr: DATEDIFF(second, start_time, end_time )
      
      - name: total_credits_used_compute
        agg: sum
        expr: credits_used_compute

      - name: max_credits_used_compute
        agg: max
        expr: credits_used_compute

      - name: total_credits_used_cloud_services
        agg: sum
        expr: credits_used_cloud_services
      - name: max_credits_used_cloud_services
        agg: max
        expr: credits_used_cloud_services

      - name: total_credits_used
        agg: sum
        expr: credits_used
      - name: max_credits_used
        agg: max
        expr: credits_used

      - name: total_bytes_loaded
        agg: sum
        expr: bytes
      - name: total_files_loaded
        agg: sum
        expr: files

metrics:
  - name: total_elapsed_seconds
    description: Sum of total elapsed seconds which is end - start time.
    type: simple
    label: total elapsed seconds
    type_params: 
      measure: total_elapsed_seconds

  - name: total_credits_used_compute
    type: simple
    label: total credits used compute
    type_params: 
      measure: total_credits_used_compute

  - name: total_credits_used_cloud_services
    type: simple
    label: total credits used cloud services
    type_params: 
      measure: total_credits_used_cloud_services

  - name: total_credits_used
    type: simple
    label: total credits used
    type_params: 
      measure: total_credits_used

  - name: total_bytes_loaded
    type: simple
    label: total bytes loaded
    type_params: 
      measure: total_bytes_loaded

  - name: total_files_loaded
    type: simple
    label: total files loaded
    type_params: 
      measure: total_files_loaded
    filter: | 
        total_files_loaded is not null
