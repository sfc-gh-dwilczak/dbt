semantic_models:
  - name: warehouse_metering
    model: ref('fct_snowflake__warehouse_metering_history')
    description:  '{{ doc("snowflake__warehouse_metering_history") }}'
    primary_entity: warehouse_metering

    dimensions:
      - name: start_date
        expr: start_time::date
        type: time
        type_params:
          time_granularity: day
      - name: warehouse_name
        description: '{{ doc("snowflake__warehouse_name") }}'
        type: categorical
      - name: warehouse_id
        description: '{{ doc("snowflake__warehouse_id") }}'
        type: categorical
        expr: name
    
    defaults:
      agg_time_dimension: start_date

    measures:
      - name: total_elapsed_seconds
        description: '{{ doc("snowflake__total_elapsed_seconds") }}'
        agg: sum
        expr: DATEDIFF(second, start_time, end_time )

      - name: longest_elapsed_seconds
        description: '{{ doc("snowflake__longest_elapsed_seconds") }}'
        agg: max
        expr: DATEDIFF(second, start_time, end_time )
      
      - name: total_credits_used_compute
        description: '{{ doc("snowflake__credits_used_compute") }}'
        agg: sum
        expr: credits_used_compute

      - name: max_credits_used_compute
        description: '{{ doc("snowflake__credits_used_compute") }}'
        agg: max
        expr: credits_used_compute

      - name: total_credits_used_cloud_services
        description: '{{ doc("snowflake__credits_used_cloud_services") }}'
        agg: sum
        expr: credits_used_cloud_services

      - name: max_credits_used_cloud_services
        description: '{{ doc("snowflake__credits_used_cloud_services") }}'
        agg: max
        expr: credits_used_cloud_services

      - name: total_credits_used
        description: '{{ doc("snowflake__credits_used") }}'
        agg: sum
        expr: credits_used
      - name: max_credits_used
        description: '{{ doc("snowflake__credits_used") }}'
        agg: max
        expr: credits_used
