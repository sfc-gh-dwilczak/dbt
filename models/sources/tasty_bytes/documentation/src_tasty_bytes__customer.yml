version: 2

models:
  - name: src_tasty_bytes__customer
    description: Customer dimensions.
    columns:
      - name: customer_id
        description: "{{ doc('tasty_bytes__customer_id') }}"
        tests:
          - not_null
          - unique
      - name: first_name
        description: "{{ doc('tasty_bytes__first_name') }}"
      - name: last_name
        description: "{{ doc('tasty_bytes__last_name') }}"
      - name: city_id
        description: "{{ doc('tasty_bytes__city_id') }}"
        tests:
          - relationships:
              to: ref('src_tasty_bytes__city')
              field: city_id
              config:
                severity: warn
      - name: postal_code
        description: "{{ doc('tasty_bytes__postal_code') }}"
      - name: preferred_language
        description: "{{ doc('tasty_bytes__preferred_language') }}"
      - name: gender
        description: "{{ doc('tasty_bytes__gender') }}"
      - name: favourite_brand
        description: "{{ doc('tasty_bytes__favourite_brand') }}"
      - name: marital_status
        description: "{{ doc('tasty_bytes__marital_status') }}"
      - name: children_count
        description: "{{ doc('tasty_bytes__children_count') }}"
      - name: sign_up_date
        description: "{{ doc('tasty_bytes__sign_up_date') }}"
      - name: birthday_date
        description: "{{ doc('tasty_bytes__birthday_date') }}"
      - name: email
        description: "{{ doc('tasty_bytes__email') }}"
      - name: phone_number
        description: "{{ doc('tasty_bytes__phone_number') }}"

semantic_models:
  - name: customer
    description: Customer dimensions
    model: ref('src_tasty_bytes__customer')
    defaults:
      agg_time_dimension: sign_up_date
    entities:
      - name: customer
        type: primary
        expr: customer_id
      - name: city
        type: foreign
    dimensions:
      - name: sign_up_date
        type: time
        type_params:
          time_granularity: day
      - name: first_name
        type: categorical
      - name: last_name
        type: categorical
      - name: postal_code
        type: categorical
      - name: preferred_language
        type: categorical
      - name: gender
        type: categorical
      - name: favourite_brand
        type: categorical
      - name: marital_status
        type: categorical
      - name: children_count
        type: categorical
      - name: birthday_date
        type: categorical
      - name: email
        type: categorical
      - name: phone_number
        type: categorical
    measures:
      - name: new_customers
        description: Total customers to date.
        expr: 1
        agg: sum

metrics:
  - name: new_customers
    label: new_customers
    type: simple
    type_params:
      measure: new_customers
